# ðŸš€ Render Deployment Guide
# Nyandiwa Smart Poultry Connect

## âœ… Pre-Deployment Checklist

Your Django app is now **100% ready for Render deployment**! All necessary configuration files have been created:

- âœ… `requirements.txt` - Updated with production dependencies
- âœ… `build.sh` - Build script for Render
- âœ… `render.yaml` - Render service configuration
- âœ… `settings.py` - Updated for production (environment variables, PostgreSQL, WhiteNoise)
- âœ… `.gitignore` - Protecting sensitive files

## ðŸ“¦ What's Been Configured

### Production Dependencies Added:
- **gunicorn** - Production WSGI server
- **whitenoise** - Static file serving
- **psycopg2-binary** - PostgreSQL database adapter
- **dj-database-url** - Database URL parser

### Settings.py Updates:
- âœ… Environment variables for all sensitive data
- âœ… PostgreSQL database configuration
- âœ… WhiteNoise middleware for static files
- âœ… Production security settings (SSL, HSTS, secure cookies)
- âœ… M-Pesa configuration from environment variables

## ðŸš€ Deployment Steps

### Step 1: Push Changes to GitHub

```bash
# Add all new files
git add .

# Commit changes
git commit -m "Add Render deployment configuration"

# Push to GitHub
git push origin main
```

### Step 2: Create Render Account

1. Go to https://render.com/
2. Sign up with your GitHub account
3. Authorize Render to access your repositories

### Step 3: Deploy from Dashboard

#### Option A: Use render.yaml (Recommended)

1. Click **"New +"** â†’ **"Blueprint"**
2. Connect your GitHub repository: **ChickenFarm**
3. Render will automatically detect `render.yaml`
4. Click **"Apply"**
5. Wait for deployment (5-10 minutes)

#### Option B: Manual Setup

1. Click **"New +"** â†’ **"Web Service"**
2. Connect your repository: **ChickenFarm**
3. Configure:
   - **Name:** chickenfarm
   - **Runtime:** Python 3
   - **Build Command:** `./build.sh`
   - **Start Command:** `gunicorn ChickenFarm.wsgi:application`
   - **Instance Type:** Free

4. Click **"Create Web Service"**

### Step 4: Add PostgreSQL Database

1. In Render Dashboard, click **"New +"** â†’ **"PostgreSQL"**
2. Configure:
   - **Name:** chickenfarm-db
   - **Database:** chickenfarm
   - **Plan:** Free
3. Click **"Create Database"**
4. Copy the **Internal Database URL**

### Step 5: Configure Environment Variables

Go to your web service â†’ **"Environment"** â†’ Add these variables:

#### Required Variables:

```bash
# Django Settings
SECRET_KEY=<auto-generated-by-render>
DEBUG=False
ALLOWED_HOSTS=your-app-name.onrender.com

# Database (from your PostgreSQL service)
DATABASE_URL=<paste-internal-database-url>

# M-Pesa Configuration (Production)
MPESA_ENVIRONMENT=production
MPESA_CONSUMER_KEY=<your-daraja-consumer-key>
MPESA_CONSUMER_SECRET=<your-daraja-consumer-secret>
MPESA_SHORTCODE=<your-business-paybill>
MPESA_PASSKEY=<your-daraja-passkey>
MPESA_CALLBACK_URL=https://your-app-name.onrender.com/mpesa/callback/
```

#### How to Get M-Pesa Production Credentials:

1. Visit: https://developer.safaricom.co.ke/
2. Apply for production access
3. Get your live paybill/till number
4. Get production Consumer Key, Secret, and Passkey

### Step 6: Deploy!

1. Click **"Manual Deploy"** â†’ **"Deploy latest commit"**
2. Watch the build logs
3. Wait for **"Build successful"** message
4. Your site will be live at: `https://your-app-name.onrender.com`

## ðŸ”§ Post-Deployment Configuration

### Update ALLOWED_HOSTS

After getting your Render URL:

1. Go to **Environment Variables**
2. Update `ALLOWED_HOSTS`:
   ```
   ALLOWED_HOSTS=chickenfarm.onrender.com,www.chickenfarm.onrender.com
   ```

### Update M-Pesa Callback URL

1. Update `MPESA_CALLBACK_URL` to match your Render domain:
   ```
   MPESA_CALLBACK_URL=https://chickenfarm.onrender.com/mpesa/callback/
   ```

### Create Superuser (Admin Access)

1. Go to your Render web service
2. Click **"Shell"** tab
3. Run:
   ```bash
   python manage.py createsuperuser
   ```
4. Enter username, email, and password
5. Access admin at: `https://your-app.onrender.com/admin/`

## ðŸ“Š Monitoring Your Application

### Check Logs

1. Go to your web service in Render
2. Click **"Logs"** tab
3. Monitor for errors or M-Pesa transactions

### View Database

1. Go to your PostgreSQL service
2. Click **"Connect"** 
3. Use provided credentials to connect with a database client

## ðŸŽ¯ Testing Deployment

### Test Website:

1. Visit: `https://your-app-name.onrender.com`
2. Navigate to Products page
3. Add items to cart
4. Proceed to checkout

### Test M-Pesa (Production):

1. Use REAL Safaricom phone number
2. Select M-Pesa payment
3. Enter your number (e.g., 0712345678)
4. Check your phone for STK Push
5. Enter M-Pesa PIN
6. Wait for confirmation

**Note:** Production M-Pesa requires:
- Real Safaricom credentials
- Approved business account
- Live paybill/till number

## ðŸ” Security Best Practices

### Environment Variables

âœ… **NEVER commit these to GitHub:**
- SECRET_KEY
- MPESA_CONSUMER_KEY
- MPESA_CONSUMER_SECRET
- MPESA_PASSKEY
- DATABASE_URL

âœ… **Always set in Render dashboard** under Environment Variables

### Django Security

The following are automatically configured when `DEBUG=False`:
- âœ… HTTPS redirect
- âœ… Secure cookies
- âœ… HSTS headers
- âœ… XSS protection
- âœ… Content type sniffing protection

## ðŸ†“ Render Free Tier Limits

### Web Service:
- âœ… 750 hours/month (enough for 1 site)
- âœ… Automatic HTTPS
- âœ… Custom domains
- âš ï¸ Spins down after 15 min inactivity (first request takes ~30s)

### PostgreSQL:
- âœ… 1 GB storage
- âœ… 97 hours/month active time
- âš ï¸ Expires after 90 days (backup your data!)

### Upgrading:
- Paid plans start at $7/month for web service
- PostgreSQL paid plans: $7/month

## ðŸ› Troubleshooting

### Build Failed

**Check:**
1. Requirements.txt syntax
2. Python version compatibility
3. Build logs for specific errors

**Fix:**
- Update `requirements.txt`
- Push changes
- Trigger manual deploy

### Database Connection Error

**Check:**
1. DATABASE_URL is set correctly
2. PostgreSQL service is active
3. Internal database URL (not external)

**Fix:**
- Copy Internal Database URL from PostgreSQL service
- Update DATABASE_URL environment variable

### Static Files Not Loading

**Check:**
1. `python manage.py collectstatic` ran in build.sh
2. WhiteNoise middleware is configured
3. STATIC_ROOT is set correctly

**Fix:**
- Verify build logs show "collectstatic" command
- Check settings.py has WhiteNoise in MIDDLEWARE

### M-Pesa Callback Not Working

**Check:**
1. Callback URL is publicly accessible
2. URL matches your Render domain
3. ALLOWED_HOSTS includes your domain

**Fix:**
- Update MPESA_CALLBACK_URL
- Add domain to ALLOWED_HOSTS
- Check Safaricom Daraja portal settings

### Site is Slow

**Reason:** Free tier spins down after 15 min inactivity

**Solutions:**
- Upgrade to paid plan ($7/month)
- Use a keep-alive service (ping every 14 minutes)
- Accept the cold start delay

## ðŸ“‹ Environment Variables Reference

| Variable | Example | Required |
|----------|---------|----------|
| SECRET_KEY | (auto-generated) | âœ… Yes |
| DEBUG | False | âœ… Yes |
| ALLOWED_HOSTS | yourapp.onrender.com | âœ… Yes |
| DATABASE_URL | postgres://user:pass@host/db | âœ… Yes |
| MPESA_ENVIRONMENT | production | âœ… Yes |
| MPESA_CONSUMER_KEY | xxxxxxxxxxx | âœ… Yes |
| MPESA_CONSUMER_SECRET | xxxxxxxxxxx | âœ… Yes |
| MPESA_SHORTCODE | 123456 | âœ… Yes |
| MPESA_PASSKEY | xxxxxxxxxxx | âœ… Yes |
| MPESA_CALLBACK_URL | https://yourapp.onrender.com/mpesa/callback/ | âœ… Yes |

## ðŸŽ‰ Success Checklist

After deployment, verify:

- âœ… Website loads at Render URL
- âœ… Static files (CSS/JS) load correctly
- âœ… Can browse products
- âœ… Can add items to cart
- âœ… Can proceed to checkout
- âœ… M-Pesa payment initiates
- âœ… STK Push appears on phone
- âœ… Payment confirmation works
- âœ… Admin panel accessible
- âœ… Orders appear in database

## ðŸš€ Next Steps After Deployment

### 1. Custom Domain (Optional)

1. Buy domain from Namecheap, GoDaddy, etc.
2. In Render dashboard â†’ **"Settings"** â†’ **"Custom Domain"**
3. Add your domain
4. Update DNS records as instructed
5. Update ALLOWED_HOSTS with new domain

### 2. Email Configuration (Optional)

For order confirmations and notifications:
- Use SendGrid, Mailgun, or Amazon SES
- Add email settings to environment variables
- Configure in settings.py

### 3. Monitoring (Optional)

- Set up Sentry for error tracking
- Use Render's built-in metrics
- Configure uptime monitoring (UptimeRobot, Pingdom)

### 4. Backups

**Important for Free PostgreSQL:**
- Database expires after 90 days
- Export data regularly:
  ```bash
  python manage.py dumpdata > backup.json
  ```

### 5. Go Production with M-Pesa

1. Apply for Safaricom production API access
2. Get live credentials
3. Update environment variables
4. Change MPESA_ENVIRONMENT to 'production'
5. Test with small real transaction

## ðŸ“ž Support Resources

### Render Support:
- Documentation: https://render.com/docs
- Community: https://community.render.com/
- Status: https://status.render.com/

### Django Deployment:
- Official Guide: https://docs.djangoproject.com/en/6.0/howto/deployment/
- Render Django Guide: https://render.com/docs/deploy-django

### M-Pesa:
- Daraja Portal: https://developer.safaricom.co.ke/
- Support: apisupport@safaricom.co.ke

## âœ¨ Your Deployment is Ready!

All configuration files are in place. Follow the steps above to deploy your Chicken Farm e-commerce website to Render.

**Estimated deployment time:** 15-20 minutes

**Cost:** FREE (with Render free tier)

---

**Ready to deploy?** Start with Step 1: Push to GitHub! ðŸš€
